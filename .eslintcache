[{"/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/App.tsx":"1","/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/components/LocalUserIcon.tsx":"2","/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/components/RemoteUserIcon.tsx":"3","/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/components/Room.tsx":"4","/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/components/UserIcon.tsx":"5","/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/index.tsx":"6","/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/utils/audio.ts":"7","/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/utils/user.ts":"8","/Users/keigomichi/.ghq/github.com/keigomichi/hicord/vite.config.ts":"9"},{"size":206,"mtime":1657284706414,"results":"10","hashOfConfig":"11"},{"size":2854,"mtime":1657286649868,"results":"12","hashOfConfig":"11"},{"size":827,"mtime":1657286704918,"results":"13","hashOfConfig":"11"},{"size":4203,"mtime":1657284706415,"results":"14","hashOfConfig":"11"},{"size":773,"mtime":1657284706415,"results":"15","hashOfConfig":"11"},{"size":181,"mtime":1657284706415,"results":"16","hashOfConfig":"11"},{"size":1676,"mtime":1657284706415,"results":"17","hashOfConfig":"18"},{"size":387,"mtime":1657284706415,"results":"19","hashOfConfig":"11"},{"size":217,"mtime":1657284706416,"results":"20","hashOfConfig":"11"},{"filePath":"21","messages":"22","suppressedMessages":"23","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"ddz0xz",{"filePath":"24","messages":"25","suppressedMessages":"26","errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"27","messages":"28","suppressedMessages":"29","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"30","messages":"31","suppressedMessages":"32","errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"33"},{"filePath":"34","messages":"35","suppressedMessages":"36","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"37","messages":"38","suppressedMessages":"39","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"40","messages":"41","suppressedMessages":"42","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"1id2yz9",{"filePath":"43","messages":"44","suppressedMessages":"45","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},{"filePath":"46","messages":"47","suppressedMessages":"48","errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/App.tsx",[],[],"/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/components/LocalUserIcon.tsx",["49","50"],[],"/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/components/RemoteUserIcon.tsx",["51"],[],"/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/components/Room.tsx",["52"],[],"import Peer, { DataConnection, SfuRoom } from 'skyway-js'\nimport type { Component } from 'solid-js';\nimport { createEffect, createSignal, For } from 'solid-js';\nimport LocalUserIcon from './LocalUserIcon'\nimport { localUserInfo, setLocalUserInfo, remoteUserInfos, setRemoteUserInfos, UserCoord, UserInfo } from '../utils/user'\nimport RemoteUserIcon from './RemoteUserIcon'\n\nconst KEY = import.meta.env.VITE_SKY_WAY_API_KEY\nexport const PEER = new Peer({ key: KEY as string })\n\nconst ROOM_X = 2048\nconst ROOM_Y = 2048\n\nexport const Room: Component<{ roomId: string }> = ({ roomId }) => {\n  // Local\n  const [localStream, setLocalStream] = createSignal<MediaStream>()\n  // Room\n  const [room, setRoom] = createSignal<SfuRoom>()\n  const [isStarted, setIsStarted] = createSignal(false)\n  createEffect(() => {\n    navigator.mediaDevices\n      .getUserMedia({ video: false, audio: true })\n      .then((stream) => {\n        setLocalStream(stream)\n      })\n      .catch((e) => {\n        console.log(e)\n      })\n  }, [])\n  const onStart = () => {\n    if (PEER) {\n      if (!PEER.open) {\n        return\n      }\n      if (localStream() === undefined) {\n        return\n      }\n      setLocalUserInfo({\n        stream: localStream(),\n        peerId: PEER.id,\n        x: ROOM_X / 2,\n        y: ROOM_Y / 2,\n        deg: 0\n      })\n      const tmpRoom = PEER.joinRoom<SfuRoom>(roomId, {\n        mode: 'sfu',\n        stream: localStream(),\n      })\n      tmpRoom.once('open', () => {\n        console.log('=== あなたが参加しました ===\\n')\n      })\n      tmpRoom.on('peerJoin', (peerId) => {\n        console.log(`=== ${peerId} が入室しました ===\\n`)\n      })\n      tmpRoom.on('stream', async (stream) => {\n        const remoteUserInfo = {\n          stream: stream,\n          peerId: stream.peerId,\n          x: ROOM_X / 2,\n          y: ROOM_Y / 2,\n          deg: 0,\n        }\n        // if (localUserInfo) {\n        //   audioProcessing(localUserInfo, remoteUserInfo)\n        // }\n        setRemoteUserInfos((prev) => [\n          ...prev,\n          remoteUserInfo,\n        ])\n      })\n      tmpRoom.on('peerLeave', (peerId) => {\n        setRemoteUserInfos((prev) => {\n          return prev.filter((userInfo) => {\n            if (userInfo.peerId === peerId) {\n              userInfo.stream.getTracks().forEach((track) => track.stop())\n            }\n            return userInfo.peerId !== peerId\n          })\n        })\n        console.log(`=== ${peerId} が退出しました ===\\n`)\n      })\n      setRoom(tmpRoom)\n      // DataConnection\n      PEER.on('connection', dataConnection => {\n        dataConnection.on('data', data => {\n          console.log(data)\n          const userCoord = data as UserCoord\n          setRemoteUserInfos((prev) => {\n            return prev.map((userInfo) => {\n              if (userInfo.peerId === dataConnection.remoteId) {\n                return {\n                  ...userInfo,\n                  x: userCoord.x,\n                  y: userCoord.y,\n                  deg: userCoord.deg,\n                } as UserInfo\n              }\n              return userInfo\n            })\n          })\n        });\n      });\n    }\n    setIsStarted((prev) => !prev)\n  }\n  const onEnd = () => {\n    if (room()) {\n      room().close()\n      setRemoteUserInfos((prev) => {\n        return prev.filter((userInfo) => {\n          userInfo.stream.getTracks().forEach((track) => track.stop())\n          return false\n        })\n      })\n    }\n    setLocalUserInfo()\n    setIsStarted((prev) => !prev)\n    console.log('=== あなたが退出しました ===\\n')\n  }\n\n  return (\n    <div>\n      <div class='relative bg-orange-100' style={{height:`${ROOM_X}px`, width:`${ROOM_Y}px`}}>\n        {/* buttons */}\n        <button class='sticky top-0 left-0' onClick={() => onStart()} disabled={isStarted()}>\n          開始\n        </button>\n        <button class='sticky top-0 left-8' onClick={() => onEnd()} disabled={!isStarted()}>\n          停止\n        </button>\n        {/* Remote User Icons */}\n        <For each={remoteUserInfos()}>{info => <RemoteUserIcon info={info} />}</For>\n        {/* Local User Icon */}\n        { localUserInfo() ? <LocalUserIcon /> : null }\n      </div>\n    </div>\n  )\n}\n","/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/components/UserIcon.tsx",[],[],"/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/index.tsx",[],[],"/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/utils/audio.ts",[],[],"/Users/keigomichi/.ghq/github.com/keigomichi/hicord/src/utils/user.ts",[],[],"/Users/keigomichi/.ghq/github.com/keigomichi/hicord/vite.config.ts",[],[],{"ruleId":"53","severity":1,"message":"54","line":9,"column":16,"nodeType":"55","messageId":"56","endLine":9,"endColumn":17},{"ruleId":"53","severity":1,"message":"54","line":81,"column":14,"nodeType":"55","messageId":"56","endLine":81,"endColumn":15},{"ruleId":"53","severity":1,"message":"57","line":2,"column":24,"nodeType":"55","messageId":"56","endLine":2,"endColumn":36},{"ruleId":"53","severity":1,"message":"58","line":1,"column":16,"nodeType":"55","messageId":"56","endLine":1,"endColumn":30},"@typescript-eslint/no-unused-vars","'e' is defined but never used.","Identifier","unusedVar","'createSignal' is defined but never used.","'DataConnection' is defined but never used."]